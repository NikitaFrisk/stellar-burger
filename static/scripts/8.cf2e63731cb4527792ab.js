"use strict";(self.webpackChunkreact_webpack_starter=self.webpackChunkreact_webpack_starter||[]).push([[8],{8605:(e,t,n)=>{n.d(t,{As:()=>s.A,mN:()=>c,iO:()=>u});var r=n(6540),i=function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},i.apply(this,arguments)};function c(e){void 0===e&&(e={});var t=(0,r.useState)(e),n=t[0],c=t[1];return{values:n,handleChange:function(e){var t,r=e.target,s=r.value,a=r.name;c(i(i({},n),((t={})[a]=s,t)))},setValues:c}}var s=n(8867),a=n(9204),o=n(6731),u=function(){return{ingredients:(0,a.GV)(o.vm),loading:(0,a.GV)(o.Jq),error:(0,a.GV)(o.Ff)}};n(7571),n(8823)},8867:(e,t,n)=>{n.d(t,{A:()=>c});var r=n(9204),i=n(7321),c=function(){return{loading:(0,r.GV)(i.H$),error:(0,r.GV)(i.ZB),isAuthenticated:(0,r.GV)(i.Kc),user:(0,r.GV)(i.mB),isPasswordResetRequested:(0,r.GV)(i.fv)}}},5008:(e,t,n)=>{n.r(t),n.d(t,{HomePage:()=>O});var r=n(4848),i=n(6782),c=n(6749),s=n(3231);const a="burger-ingredients-module__section__Oy0fT";var o=n(8410),u=n(9204),l=n(3344),d=n(7571),_=n(7767),m=n(6540);const g=(0,m.memo)((function(e){var t=e.ingredient,n=e.onClick,i=(0,u.GV)(d.vm),c=(0,u.GV)(d.Ak),a=(0,_.zy)(),g=(0,_.Zp)(),x=(0,u.jL)(),f=(0,m.useMemo)((function(){return"bun"===t.type?c&&c._id===t._id?1:0:i.filter((function(e){return e._id===t._id})).length}),[t._id,t.type,c,i]),p=(0,o.i)({type:"ingredient",item:function(){return t},collect:function(e){return{isDragging:e.isDragging()}}}),v=p[0].isDragging,h=p[1],b=(0,m.useCallback)((function(e){e.preventDefault(),x((0,l.DQ)(t)),n&&n(),sessionStorage.setItem("modalIngredient",t._id),g("/ingredients/".concat(t._id),{state:{background:a}})}),[x,t,n,g,a]),j=(0,m.useCallback)((function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),x((0,l.DQ)(t)),n&&n(),sessionStorage.setItem("modalIngredient",t._id),g("/ingredients/".concat(t._id),{state:{background:a}}))}),[x,t,n,g,a]);return(0,r.jsxs)("div",{className:"ingredient-card-module__card__W2SmY",onClick:b,onKeyDown:j,role:"button",tabIndex:0,ref:h,style:{opacity:v?.5:1},"data-testid":"ingredient-item",children:[(0,r.jsx)("img",{src:t.image,alt:t.name}),f>0&&(0,r.jsx)("div",{className:"ingredient-card-module__count__r6lLF",children:f}),(0,r.jsxs)("div",{className:"ingredient-card-module__price__QcdeR",children:[(0,r.jsx)("span",{className:"text text_type_digits-default",children:t.price}),(0,r.jsx)(s.px,{type:"primary"})]}),(0,r.jsx)("p",{className:"".concat("ingredient-card-module__name__rIl9H"," text text_type_main-default"),children:t.name})]})}),(function(e,t){return e.ingredient._id===t.ingredient._id&&e.onClick===t.onClick})),x=(0,m.memo)((function(e){var t=e.title,n=e.ingredients,i=e.titleRef;return(0,r.jsxs)("div",{className:"burger-ingredients-module__category__JW7iO",children:[(0,r.jsx)("h2",{ref:i,className:"".concat("burger-ingredients-module__categoryTitle__WPHLN"," text text_type_main-medium"),children:t}),(0,r.jsx)("div",{className:"burger-ingredients-module__items__hKluL",children:n.map((function(e){return(0,r.jsx)(g,{ingredient:e},e._id)}))})]})}),(function(e,t){return e.title===t.title&&e.ingredients.length===t.ingredients.length&&e.ingredients.every((function(e,n){return e._id===t.ingredients[n]._id}))}));var f=n(8605),p=n(5089),v=n(1440);const h=function(){var e=(0,m.useState)("bun"),t=e[0],n=e[1],i=(0,m.useRef)(null),c=(0,m.useRef)(null),o=(0,m.useRef)(null),u=(0,m.useRef)(null),l=(0,f.iO)(),d=l.ingredients,_=l.loading,g=l.error,h=(0,m.useMemo)((function(){return{bun:d.filter((function(e){return"bun"===e.type})),sauce:d.filter((function(e){return"sauce"===e.type})),main:d.filter((function(e){return"main"===e.type}))}}),[d]),b=function(e){n(e);var t="bun"===e?o.current:"sauce"===e?i.current:c.current;if(t&&u.current){var r=u.current.getBoundingClientRect().top,s=t.getBoundingClientRect().top;u.current.scrollTop+=s-r}};return(0,m.useEffect)((function(){var e=u.current;if(e){var t=function(){if(o.current&&i.current&&c.current){var t=e.getBoundingClientRect().top,r=o.current.getBoundingClientRect().top-t,s=i.current.getBoundingClientRect().top-t,a=c.current.getBoundingClientRect().top-t;r<=50&&n(s<=50?a<=50?"main":"sauce":"bun")}};return e.addEventListener("scroll",t),function(){return e.removeEventListener("scroll",t)}}}),[]),_?(0,r.jsx)("div",{className:a,children:(0,r.jsx)(p.k,{text:"Загрузка ингредиентов..."})}):g?(0,r.jsx)("div",{className:a,children:(0,r.jsx)(p.K,{error:"Произошла ошибка при загрузке ингредиентов: ".concat(g)})}):(0,r.jsxs)("section",{className:a,children:[(0,r.jsx)("h1",{className:"".concat("burger-ingredients-module__title__m_2QL"," ").concat(v.Xk.SECTION.TITLE),children:"Соберите бургер"}),(0,r.jsxs)("div",{className:"burger-ingredients-module__tabs__Qg3bC",children:[(0,r.jsx)(s.oz,{value:"bun",active:"bun"===t,onClick:b,children:"Булки"}),(0,r.jsx)(s.oz,{value:"sauce",active:"sauce"===t,onClick:b,children:"Соусы"}),(0,r.jsx)(s.oz,{value:"main",active:"main"===t,onClick:b,children:"Начинки"})]}),(0,r.jsxs)("div",{ref:u,className:"burger-ingredients-module__content__ZlgO3",children:[(0,r.jsx)(x,{title:"Булки",ingredients:h.bun,titleRef:o}),(0,r.jsx)(x,{title:"Соусы",ingredients:h.sauce,titleRef:i}),(0,r.jsx)(x,{title:"Начинки",ingredients:h.main,titleRef:c})]})]})},b="burger-constructor-module__bun__OKyp4",j="burger-constructor-module__bunBottom__FCJ_d",y="burger-constructor-module__scrollArea__Thlrf",N="burger-constructor-module__placeholder__FV2fO";var k=n(5079),C=n(8823),R=n(7321),V=function(e,t,n){if(n||2===arguments.length)for(var r,i=0,c=t.length;i<c;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))},G=function(e){var t=e.item,n=e.index,i=e.handleRemove,c=(0,u.jL)(),a=(0,m.useRef)(null),l=(0,o.i)({type:"constructorElement",item:function(){return{index:n}},collect:function(e){return{isDragging:e.isDragging()}}}),_=l[0].isDragging;return(0,l[1])((0,(0,k.H)({accept:"constructorElement",hover:function(e){if(a.current){var t=e.index,r=n;t!==r&&(c((0,d.PS)({dragIndex:t,hoverIndex:r})),e.index=r)}}})[1])(a)),(0,r.jsxs)("div",{className:"burger-constructor-module__ingredient__luvSg",ref:a,style:{opacity:_?.5:1},"data-testid":"constructor-ingredient",children:[(0,r.jsx)("div",{className:"burger-constructor-module__dragIcon__Xvaov",children:(0,r.jsx)(s.WP,{type:"primary"})}),(0,r.jsx)(s.VM,{text:t.name,price:t.price,thumbnail:t.image,handleClose:function(){return i(t.uuid)}})]})};const L=function(){var e=(0,u.jL)(),t=(0,_.Zp)(),n=(0,u.GV)(d.ge),i=(0,u.GV)(R.Kc),c=(0,u.GV)(C.dW),a=(0,u.GV)(d.Ak),o=(0,u.GV)(d.vm),l=(0,k.H)({accept:"ingredient",drop:function(t){"bun"===t.type?e((0,d.Ev)(t)):e((0,d.kH)(t))},collect:function(e){return{isHover:e.isOver()}}}),g=l[0].isHover,x=l[1],f=(0,m.useCallback)((function(t){e((0,d.KT)(t))}),[e]),p=(0,m.useCallback)((function(){if(a)if(i){var n=V(V([a._id],o.map((function(e){return e._id})),!0),[a._id],!1);e((0,C.fS)(n))}else t("/login")}),[e,t,a,o,i]),v={border:g?"1px dashed #4C4CFF":"none",borderRadius:"8px",padding:g?"16px":"16px 0",transition:"all 0.2s ease"},h=a&&o.length>0&&!c;return(0,r.jsxs)("section",{className:"burger-constructor-module__section__Z3LFf",children:[(0,r.jsxs)("div",{className:"burger-constructor-module__constructorElements__RbXs_",ref:x,style:v,"data-testid":"burger-constructor",children:[a?(0,r.jsx)("div",{className:b,"data-testid":"constructor-bun-top",children:(0,r.jsx)(s.VM,{type:"top",isLocked:!0,text:"".concat(a.name," (верх)"),price:a.price,thumbnail:a.image})}):(0,r.jsx)("div",{className:"".concat(b," ").concat(N),children:(0,r.jsx)("p",{className:"text text_type_main-default text_color_inactive",children:"Перетащите булку сюда"})}),o.length>0?(0,r.jsx)("div",{className:y,"data-testid":"constructor-ingredients",children:o.map((function(e,t){return(0,r.jsx)(G,{item:e,index:t,handleRemove:f},e.uuid)}))}):(0,r.jsx)("div",{className:"".concat(y," ").concat(N),children:(0,r.jsx)("p",{className:"text text_type_main-default text_color_inactive",children:"Перетащите начинки сюда"})}),a?(0,r.jsx)("div",{className:"".concat(b," ").concat(j),"data-testid":"constructor-bun-bottom",children:(0,r.jsx)(s.VM,{type:"bottom",isLocked:!0,text:"".concat(a.name," (низ)"),price:a.price,thumbnail:a.image})}):(0,r.jsx)("div",{className:"".concat(b," ").concat(j," ").concat(N),children:(0,r.jsx)("p",{className:"text text_type_main-default text_color_inactive",children:"Перетащите булку сюда"})})]}),(0,r.jsxs)("div",{className:"burger-constructor-module__total__N4JCq",children:[(0,r.jsxs)("div",{className:"burger-constructor-module__price__KuT1O","data-testid":"total-price",children:[(0,r.jsx)("span",{className:"text text_type_digits-medium",children:n}),(0,r.jsx)(s.px,{type:"primary"})]}),(0,r.jsx)(s.$n,{htmlType:"button",type:"primary",size:"large",onClick:p,disabled:!h,"data-testid":"order-button",children:c?"Оформляем заказ...":i?"Оформить заказ":"Войти для оформления"})]})]})};var O=function(){return(0,r.jsx)("main",{className:"home-module__main__bXiec",children:(0,r.jsx)(i.Q,{backend:c.t2,children:(0,r.jsxs)("div",{className:"home-module__container__MtW9j",children:[(0,r.jsx)(h,{}),(0,r.jsx)(L,{})]})})})}}}]);