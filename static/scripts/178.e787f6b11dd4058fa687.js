"use strict";(self.webpackChunkreact_webpack_starter=self.webpackChunkreact_webpack_starter||[]).push([[178],{8123:(e,r,a)=>{a.d(r,{B:()=>t});var c=a(4848),n=a(3231);var t=function(e){var r,a,t,o,s,d,i=e.order,l=e.ingredients,u=e.showStatus,_=void 0===u||u,m=e.onClick,h=i.ingredients.map((function(e){return l.find((function(r){return r._id===e}))})).filter(Boolean),p=h.reduce((function(e,r){return e+r.price}),0),g=h.slice(0,6),f=h.length-6;return(0,c.jsxs)("div",{className:"order-card-module__orderCard__kTURt",onClick:m,children:[(0,c.jsxs)("div",{className:"order-card-module__orderHeader__xEdQV",children:[(0,c.jsx)("span",{className:"order-card-module__orderId__pAzuR",children:(d=i.number,"#".concat(d.toString().padStart(6,"0")))}),(0,c.jsx)("span",{className:"order-card-module__timestamp__CV6pp",children:(r=i.createdAt,a=new Date(r),t=(new Date).getTime()-a.getTime(),o=Math.floor(t/864e5),s=a.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),0===o?"Сегодня, ".concat(s):1===o?"Вчера, ".concat(s):o<=7?"".concat(o," дня назад, ").concat(s):a.toLocaleDateString("ru-RU")+", ".concat(s))})]}),(0,c.jsxs)("div",{className:"order-card-module__orderInfo__YP8ZK",children:[(0,c.jsx)("h3",{className:"order-card-module__burgerName__I1HhJ",children:i.name}),_&&(0,c.jsx)("div",{className:"".concat("order-card-module__status__MPbjR"," ").concat(function(e){switch(e){case"done":return"order-card-module__statusDone__x57cz";case"pending":return"order-card-module__statusPending__MjwBg";case"created":return"order-card-module__statusCreated__fwnQK";default:return""}}(i.status)),children:function(e){switch(e){case"done":return"Выполнен";case"pending":return"Готовится";case"created":return"Создан";default:return""}}(i.status)})]}),(0,c.jsxs)("div",{className:"order-card-module__orderFooter__YSgop",children:[(0,c.jsx)("div",{className:"order-card-module__ingredients__Ow5aa",children:g.map((function(e,r){var a=5===r&&f>0;return(0,c.jsxs)("div",{className:"order-card-module__ingredientPreview__ab8hz",style:{zIndex:6-r},children:[(0,c.jsx)("img",{src:e.image,alt:e.name,className:"order-card-module__ingredientImage__qn5x8"}),a&&(0,c.jsx)("div",{className:"order-card-module__moreOverlay__c3erX",children:(0,c.jsxs)("span",{className:"order-card-module__moreCount__Iv9uW",children:["+",f]})})]},e._id+r)}))}),(0,c.jsxs)("div",{className:"order-card-module__price__PAdlT",children:[(0,c.jsx)("span",{className:"order-card-module__priceValue__ReBGy",children:p}),(0,c.jsx)("div",{className:"order-card-module__priceIcon__PvLbe",children:(0,c.jsx)(n.px,{type:"primary"})})]})]})]})}},4178:(e,r,a)=>{a.r(r),a.d(r,{OrderHistoryPage:()=>_});var c=a(4848),n=a(6540),t=a(7767),o=a(8123),s=a(442),d=a(9204),i=a(2026),l=a(6731),u=a(7321);var _=function(){var e=(0,d.jL)(),r=(0,t.Zp)(),a=(0,t.zy)(),_=(0,n.useState)(!1),m=_[0],h=_[1],p=(0,n.useState)(null),g=p[0],f=p[1],v=(0,n.useRef)(!1),x=(0,d.GV)(i.SM),j=(0,d.GV)(i.ht),N=(0,d.GV)(i.$3),w=((0,d.GV)(i.cd),(0,d.GV)(l.vm)),k=(0,d.GV)(u.mB);return(0,n.useEffect)((function(){var e;if(N&&g){var r=Date.now()-g;r>=5e3?h(!0):e=setTimeout((function(){h(!0)}),5e3-r)}else N||h(!1);return function(){e&&clearTimeout(e)}}),[N,g]),(0,n.useEffect)((function(){f(Date.now()),h(!1),v.current=!1;var r=localStorage.getItem("accessToken");if(r&&k&&!v.current){v.current=!0;var a=r.replace("Bearer ",""),c="wss://norma.nomoreparties.space/orders?token=".concat(a);console.log("[OrderHistory] Connecting to WebSocket..."),e((0,i.CA)(c))}return function(){console.log("[OrderHistory] Disconnecting from WebSocket..."),e((0,i.$c)()),v.current=!1}}),[e,k]),j&&0===x.length?(0,c.jsx)(s.a,{text:"Загрузка истории заказов...",size:"large"}):m&&N?(0,c.jsxs)("div",{className:"order-history-module__error__cckrY",children:[(0,c.jsx)("h2",{children:"Ошибка загрузки истории заказов"}),(0,c.jsx)("p",{children:N}),(0,c.jsx)("button",{onClick:function(){f(Date.now()),h(!1),v.current=!1;var r=localStorage.getItem("accessToken");if(r&&!v.current){v.current=!0;var a=r.replace("Bearer ",""),c="wss://norma.nomoreparties.space/orders?token=".concat(a);e((0,i.CA)(c))}},children:"Попробовать снова"})]}):0===x.length?(0,c.jsxs)("div",{className:"order-history-module__empty__zYrlW",children:[(0,c.jsx)("h2",{children:"История заказов пуста"}),(0,c.jsx)("p",{children:"Вы еще не сделали ни одного заказа"})]}):(0,c.jsx)("div",{className:"order-history-module__orderHistoryPage__Y_drt",children:(0,c.jsx)("div",{className:"order-history-module__ordersList__KwGt9",children:x.map((function(e){return(0,c.jsx)(o.B,{order:e,ingredients:w,showStatus:!0,onClick:function(){return c=e.number,void r("/profile/orders/".concat(c),{state:{backgroundLocation:a}});var c}},e._id)}))})})}}}]);