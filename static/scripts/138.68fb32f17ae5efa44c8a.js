"use strict";(self.webpackChunkreact_webpack_starter=self.webpackChunkreact_webpack_starter||[]).push([[138],{3138:(e,r,n)=>{n.r(r),n.d(r,{OrderInfoPage:()=>x});var i=n(4848),o=n(6540),t=n(7767),s=n(3231);var c=function(e){var r=e.ingredient,n=e.count,o=r.price*n;return(0,i.jsxs)("div",{className:"order-ingredient-item-module__ingredientItem__g3rDm",children:[(0,i.jsx)("div",{className:"order-ingredient-item-module__ingredientPreview__t6uaw",children:(0,i.jsx)("div",{className:"order-ingredient-item-module__illustration__iA8jG",children:(0,i.jsx)("img",{src:r.image,alt:r.name,className:"order-ingredient-item-module__img__mR6tc"})})}),(0,i.jsx)("div",{className:"order-ingredient-item-module__name__fkHcu",children:r.name}),(0,i.jsxs)("div",{className:"order-ingredient-item-module__priceSection__Tdzm_",children:[(0,i.jsx)("div",{className:"order-ingredient-item-module__countAndPrice__edds7",children:(0,i.jsxs)("span",{className:"order-ingredient-item-module__count__phlcP",children:[n," x ",r.price]})}),(0,i.jsxs)("div",{className:"order-ingredient-item-module__price__nV6nD",children:[(0,i.jsx)("span",{className:"order-ingredient-item-module__priceValue__Y_2sX",children:o}),(0,i.jsx)("div",{className:"order-ingredient-item-module__priceIcon__RVeGA",children:(0,i.jsx)(s.px,{type:"primary"})})]})]})]})},d=n(442),a=n(9204),l=n(7873),u=n(2026),m=n(7438),_=n(6731),f=n(7321);const g="order-info-module__container__PZBVM",h="order-info-module__error__JKOoR";var x=function(e){var r=e.hideOrderNumber,n=void 0!==r&&r,x=(0,t.g)().number,p=(0,t.zy)(),j=(0,a.jL)(),v=x?parseInt(x):0,N=(0,o.useState)(!1),G=N[0],S=N[1],T=(0,o.useState)(null),V=T[0],k=T[1],w=(0,a.GV)(_.vm),b=(0,a.GV)(f.mB),I=p.pathname.includes("/profile/orders"),M=(0,a.GV)((function(e){return(0,l.Xg)(e,v)})),A=(0,a.GV)((function(e){return(0,u.Hi)(e,v)})),D=(0,a.GV)(m.tS),O=(0,a.GV)(l.xX),P=(0,a.GV)(l.T9),C=((0,a.GV)(u.ht),(0,a.GV)(u.$3),(0,a.GV)(m.R4)),R=(0,a.GV)(m.xn),y=I?A||D:M||D,L=(null==y?void 0:y.number)||v,B=(0,o.useMemo)((function(){return!y&&(I?C:(!R||!P)&&!(V&&Date.now()-V>1e4)&&(O||C))}),[y,R,C,I,P,O,V]),E=I?R:P||R;(0,o.useEffect)((function(){var e;if(E&&V){var r=Date.now()-V;r>=5e3?S(!0):e=setTimeout((function(){S(!0)}),5e3-r)}else E||S(!1);return function(){e&&clearTimeout(e)}}),[E,V]),(0,o.useEffect)((function(){return k(Date.now()),S(!1),j((0,m.GS)()),I?(console.log("[OrderInfo] Making direct API request for profile order..."),j((0,m.Jc)(v)),setTimeout((function(){var e=localStorage.getItem("accessToken");if(e&&b){var r=e.replace("Bearer ",""),n="wss://norma.nomoreparties.space/orders?token=".concat(r);console.log("[OrderInfo] Connecting to order history WebSocket..."),j((0,u.CA)(n))}}),1e3)):(console.log("[OrderInfo] Connecting to feed WebSocket..."),j((0,l.aA)("wss://norma.nomoreparties.space/orders/all"))),function(){console.log("[OrderInfo] Disconnecting from WebSocket..."),j(I?(0,u.$c)():(0,l.Xm)()),j((0,m.GS)())}}),[j,I,b,v]),(0,o.useEffect)((function(){if(!I){var e=setTimeout((function(){M||D||C||!V||(console.log("[OrderInfo] Feed order ".concat(v," not found in WebSocket data after 5 seconds, making direct API request")),j((0,m.Jc)(v)))}),5e3);return function(){return clearTimeout(e)}}}),[j,v,M,D,C,I,V]);var H,X,z,J,W,K=(0,o.useMemo)((function(){if(!y||!w.length)return[];var e={};return y.ingredients.forEach((function(r){e[r]=(e[r]||0)+1})),Object.entries(e).map((function(e){var r=e[0],n=e[1],i=w.find((function(e){return e._id===r}));return i?{ingredient:i,count:n}:null})).filter(Boolean)}),[y,w]),U=(0,o.useMemo)((function(){return K.reduce((function(e,r){return e+r.ingredient.price*r.count}),0)}),[K]);return B&&!y?(0,i.jsx)("div",{className:g,children:(0,i.jsx)(d.a,{text:"Загрузка информации о заказе...",size:"large"})}):G&&!y?(0,i.jsx)("div",{className:g,children:(0,i.jsxs)("div",{className:h,children:[(0,i.jsx)("h2",{children:"Ошибка загрузки заказа"}),(0,i.jsx)("p",{children:E})]})}):y||B||E?y?(0,i.jsx)("div",{className:g,children:(0,i.jsxs)("div",{className:"order-info-module__orderInfo__ukLJx",children:[!n&&(0,i.jsxs)("div",{className:"order-info-module__orderNumber__FhbyV",children:["#",L.toString().padStart(6,"0")]}),(0,i.jsx)("div",{className:"order-info-module__orderName__APpM0",children:y.name}),(0,i.jsx)("div",{className:"".concat("order-info-module__orderStatus__GBCpK"," ").concat(function(e){switch(e){case"done":return"order-info-module__statusDone__SHmXH";case"pending":return"order-info-module__statusPending__GiKeN";case"created":return"order-info-module__statusCreated__fNUGT";default:return""}}(y.status)),children:function(e){switch(e){case"done":return"Выполнен";case"pending":return"Готовится";case"created":return"Создан";default:return"Неизвестно"}}(y.status)}),(0,i.jsx)("div",{className:"order-info-module__compositionTitle__CA8jb",children:"Состав:"}),(0,i.jsx)("div",{className:"order-info-module__ingredientsList__YSeSO",children:K.map((function(e,r){return(0,i.jsx)(c,{ingredient:e.ingredient,count:e.count},e.ingredient._id+r)}))}),(0,i.jsxs)("div",{className:"order-info-module__footer__ilAo7",children:[(0,i.jsx)("div",{className:"order-info-module__timestamp__mh0jl",children:(H=y.createdAt,X=new Date(H),z=(new Date).getTime()-X.getTime(),J=Math.floor(z/864e5),W=X.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit",timeZone:"Europe/Moscow"}),0===J?"Сегодня, ".concat(W," i-GMT+3"):1===J?"Вчера, ".concat(W," i-GMT+3"):J<=7?"".concat(J," дня назад, ").concat(W," i-GMT+3"):X.toLocaleDateString("ru-RU")+", ".concat(W," i-GMT+3"))}),(0,i.jsxs)("div",{className:"order-info-module__totalPrice__HaRa8",children:[(0,i.jsx)("span",{className:"order-info-module__priceValue__RLtmi",children:U}),(0,i.jsx)("div",{className:"order-info-module__priceIcon__oxvr2",children:(0,i.jsx)(s.px,{type:"primary"})})]})]})]})}):(0,i.jsx)("div",{className:g,children:(0,i.jsx)(d.a,{text:"Загрузка информации о заказе...",size:"large"})}):(0,i.jsx)("div",{className:g,children:(0,i.jsxs)("div",{className:h,children:[(0,i.jsx)("h2",{children:"Заказ не найден"}),(0,i.jsxs)("p",{children:["Заказ #",v," не существует или недоступен"]})]})})}}}]);