"use strict";(self.webpackChunkreact_webpack_starter=self.webpackChunkreact_webpack_starter||[]).push([[786,178],{8123:(e,r,n)=>{n.d(r,{B:()=>o});var a=n(4848),t=n(3231);var o=function(e){var r,n,o,s,i,c,l=e.order,d=e.ingredients,u=e.showStatus,m=void 0===u||u,_=e.onClick,f=l.ingredients.map((function(e){return d.find((function(r){return r._id===e}))})).filter(Boolean),p=f.reduce((function(e,r){return e+r.price}),0),h=f.slice(0,6),v=f.length-6;return(0,a.jsxs)("div",{className:"order-card-module__orderCard__kTURt",onClick:_,children:[(0,a.jsxs)("div",{className:"order-card-module__orderHeader__xEdQV",children:[(0,a.jsx)("span",{className:"order-card-module__orderId__pAzuR",children:(c=l.number,"#".concat(c.toString().padStart(6,"0")))}),(0,a.jsx)("span",{className:"order-card-module__timestamp__CV6pp",children:(r=l.createdAt,n=new Date(r),o=(new Date).getTime()-n.getTime(),s=Math.floor(o/864e5),i=n.toLocaleTimeString("ru-RU",{hour:"2-digit",minute:"2-digit"}),0===s?"Сегодня, ".concat(i):1===s?"Вчера, ".concat(i):s<=7?"".concat(s," дня назад, ").concat(i):n.toLocaleDateString("ru-RU")+", ".concat(i))})]}),(0,a.jsxs)("div",{className:"order-card-module__orderInfo__YP8ZK",children:[(0,a.jsx)("h3",{className:"order-card-module__burgerName__I1HhJ",children:l.name}),m&&(0,a.jsx)("div",{className:"".concat("order-card-module__status__MPbjR"," ").concat(function(e){switch(e){case"done":return"order-card-module__statusDone__x57cz";case"pending":return"order-card-module__statusPending__MjwBg";case"created":return"order-card-module__statusCreated__fwnQK";default:return""}}(l.status)),children:function(e){switch(e){case"done":return"Выполнен";case"pending":return"Готовится";case"created":return"Создан";default:return""}}(l.status)})]}),(0,a.jsxs)("div",{className:"order-card-module__orderFooter__YSgop",children:[(0,a.jsx)("div",{className:"order-card-module__ingredients__Ow5aa",children:h.map((function(e,r){var n=5===r&&v>0;return(0,a.jsxs)("div",{className:"order-card-module__ingredientPreview__ab8hz",style:{zIndex:6-r},children:[(0,a.jsx)("img",{src:e.image,alt:e.name,className:"order-card-module__ingredientImage__qn5x8"}),n&&(0,a.jsx)("div",{className:"order-card-module__moreOverlay__c3erX",children:(0,a.jsxs)("span",{className:"order-card-module__moreCount__Iv9uW",children:["+",v]})})]},e._id+r)}))}),(0,a.jsxs)("div",{className:"order-card-module__price__PAdlT",children:[(0,a.jsx)("span",{className:"order-card-module__priceValue__ReBGy",children:p}),(0,a.jsx)("div",{className:"order-card-module__priceIcon__PvLbe",children:(0,a.jsx)(t.px,{type:"primary"})})]})]})]})}},8605:(e,r,n)=>{n.d(r,{As:()=>s.A,mN:()=>o,iO:()=>l});var a=n(6540),t=function(){return t=Object.assign||function(e){for(var r,n=1,a=arguments.length;n<a;n++)for(var t in r=arguments[n])Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e},t.apply(this,arguments)};function o(e){void 0===e&&(e={});var r=(0,a.useState)(e),n=r[0],o=r[1];return{values:n,handleChange:function(e){var r,a=e.target,s=a.value,i=a.name;o(t(t({},n),((r={})[i]=s,r)))},setValues:o}}var s=n(8867),i=n(9204),c=n(6731),l=function(){return{ingredients:(0,i.GV)(c.vm),loading:(0,i.GV)(c.Jq),error:(0,i.GV)(c.Ff)}};n(7571),n(8823)},8867:(e,r,n)=>{n.d(r,{A:()=>o});var a=n(9204),t=n(7321),o=function(){return{loading:(0,a.GV)(t.H$),error:(0,a.GV)(t.ZB),isAuthenticated:(0,a.GV)(t.Kc),user:(0,a.GV)(t.mB),isPasswordResetRequested:(0,a.GV)(t.fv)}}},4178:(e,r,n)=>{n.r(r),n.d(r,{OrderHistoryPage:()=>m});var a=n(4848),t=n(6540),o=n(7767),s=n(8123),i=n(442),c=n(9204),l=n(2026),d=n(6731),u=n(7321);var m=function(){var e=(0,c.jL)(),r=(0,o.Zp)(),n=(0,o.zy)(),m=(0,t.useState)(!1),_=m[0],f=m[1],p=(0,t.useState)(null),h=p[0],v=p[1],x=(0,t.useRef)(!1),j=(0,c.GV)(l.SM),g=(0,c.GV)(l.ht),w=(0,c.GV)(l.$3),y=((0,c.GV)(l.cd),(0,c.GV)(d.vm)),N=(0,c.GV)(u.mB);return(0,t.useEffect)((function(){var e;if(w&&h){var r=Date.now()-h;r>=5e3?f(!0):e=setTimeout((function(){f(!0)}),5e3-r)}else w||f(!1);return function(){e&&clearTimeout(e)}}),[w,h]),(0,t.useEffect)((function(){v(Date.now()),f(!1),x.current=!1;var r=localStorage.getItem("accessToken");if(r&&N&&!x.current){x.current=!0;var n=r.replace("Bearer ",""),a="wss://norma.nomoreparties.space/orders?token=".concat(n);console.log("[OrderHistory] Connecting to WebSocket..."),e((0,l.CA)(a))}return function(){console.log("[OrderHistory] Disconnecting from WebSocket..."),e((0,l.$c)()),x.current=!1}}),[e,N]),g&&0===j.length?(0,a.jsx)(i.a,{text:"Загрузка истории заказов...",size:"large"}):_&&w?(0,a.jsxs)("div",{className:"order-history-module__error__cckrY",children:[(0,a.jsx)("h2",{children:"Ошибка загрузки истории заказов"}),(0,a.jsx)("p",{children:w}),(0,a.jsx)("button",{onClick:function(){v(Date.now()),f(!1),x.current=!1;var r=localStorage.getItem("accessToken");if(r&&!x.current){x.current=!0;var n=r.replace("Bearer ",""),a="wss://norma.nomoreparties.space/orders?token=".concat(n);e((0,l.CA)(a))}},children:"Попробовать снова"})]}):0===j.length?(0,a.jsxs)("div",{className:"order-history-module__empty__zYrlW",children:[(0,a.jsx)("h2",{children:"История заказов пуста"}),(0,a.jsx)("p",{children:"Вы еще не сделали ни одного заказа"})]}):(0,a.jsx)("div",{className:"order-history-module__orderHistoryPage__Y_drt",children:(0,a.jsx)("div",{className:"order-history-module__ordersList__KwGt9",children:j.map((function(e){return(0,a.jsx)(s.B,{order:e,ingredients:y,showStatus:!0,onClick:function(){return a=e.number,void r("/profile/orders/".concat(a),{state:{backgroundLocation:n}});var a}},e._id)}))})})}},9786:(e,r,n)=>{n.r(r),n.d(r,{ProfilePage:()=>j});var a=n(4848),t=n(6540),o=n(7767),s=n(9204),i=n(7321);const c="profile-navigation-module__navItem__L4gB6",l="profile-navigation-module__active__ExYUU",d="profile-navigation-module__inactive__KLhEw";var u=function(e){var r=e.className,n=(0,s.jL)(),t=(0,o.Zp)(),u=(0,o.zy)(),m=function(e){t(e)},_="/profile"===u.pathname||"/profile/"===u.pathname,f="/profile/orders"===u.pathname||u.pathname.startsWith("/profile/orders/");return(0,a.jsxs)("div",{className:"".concat("profile-navigation-module__navigation__naQl3"," ").concat(r||""),children:[(0,a.jsx)("div",{className:"".concat(c," ").concat(_?l:d),onClick:function(){return m("/profile")},children:"Профиль"}),(0,a.jsx)("div",{className:"".concat(c," ").concat(f?l:d),onClick:function(){return m("/profile/orders")},children:"История заказов"}),(0,a.jsx)("div",{className:"".concat(c," ").concat(d),onClick:function(){return e=void 0,r=void 0,o=function(){var e;return function(e,r){var n,a,t,o,s={label:0,sent:function(){if(1&t[0])throw t[1];return t[1]},trys:[],ops:[]};return o={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function i(i){return function(c){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o&&(o=0,i[0]&&(s=0)),s;)try{if(n=1,a&&(t=2&i[0]?a.return:i[0]?a.throw||((t=a.return)&&t.call(a),0):a.next)&&!(t=t.call(a,i[1])).done)return t;switch(a=0,t&&(i=[2&i[0],t.value]),i[0]){case 0:case 1:t=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,a=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!((t=(t=s.trys).length>0&&t[t.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!t||i[1]>t[0]&&i[1]<t[3])){s.label=i[1];break}if(6===i[0]&&s.label<t[1]){s.label=t[1],t=i;break}if(t&&s.label<t[2]){s.label=t[2],s.ops.push(i);break}t[2]&&s.ops.pop(),s.trys.pop();continue}i=r.call(e,s)}catch(e){i=[6,e],a=0}finally{n=t=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,c])}}}(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,n((0,i.y4)()).unwrap()];case 1:return r.sent(),t("/login"),[3,3];case 2:return e=r.sent(),console.error("Logout failed:",e),[3,3];case 3:return[2]}}))},new((a=void 0)||(a=Promise))((function(n,t){function s(e){try{c(o.next(e))}catch(e){t(e)}}function i(e){try{c(o.throw(e))}catch(e){t(e)}}function c(e){var r;e.done?n(e.value):(r=e.value,r instanceof a?r:new a((function(e){e(r)}))).then(s,i)}c((o=o.apply(e,r||[])).next())}));var e,r,a,o},children:"Выход"}),(0,a.jsxs)("div",{className:"profile-navigation-module__description__ZePvl",children:[_&&(0,a.jsx)("p",{children:"В этом разделе вы можете изменить свои персональные данные"}),f&&(0,a.jsx)("p",{children:"В этом разделе вы можете просмотреть свою историю заказов"})]})]})},m=n(3231),_=n(8605),f=n(5089);const p="profile-form-module__field__WSuAB";var h=function(){return h=Object.assign||function(e){for(var r,n=1,a=arguments.length;n<a;n++)for(var t in r=arguments[n])Object.prototype.hasOwnProperty.call(r,t)&&(e[t]=r[t]);return e},h.apply(this,arguments)},v=function(){var e=(0,s.jL)(),r=(0,o.Zp)(),n=(0,_.As)(),c=n.user,l=n.loading,d=n.error,u=n.isAuthenticated,v=(0,_.mN)({name:"",email:"",password:""}),x=v.values,j=v.handleChange,g=v.setValues,w=(0,t.useState)({name:"",email:""}),y=w[0],N=w[1],b=(0,t.useState)(!1),k=b[0],C=b[1];return(0,t.useEffect)((function(){u?c||e((0,i.wz)()):r("/login")}),[e,u,r,c]),(0,t.useEffect)((function(){if(c){var e={name:c.name,email:c.email};g(h(h({},e),{password:""})),N(e)}}),[c,g]),(0,t.useEffect)((function(){var e=x.name!==y.name,r=x.email!==y.email,n=""!==x.password;C(e||r||n)}),[x,y]),(0,t.useEffect)((function(){return function(){e((0,i.ET)())}}),[e]),l?(0,a.jsx)("div",{className:"profile-form-module__loading__vIanO",children:(0,a.jsx)(f.k,{text:"Загрузка профиля..."})}):c?(0,a.jsx)("div",{className:"profile-form-module__profileForm__WEXqT",children:(0,a.jsxs)("form",{onSubmit:function(r){r.preventDefault();var n={};x.name!==y.name&&(n.name=x.name),x.email!==y.email&&(n.email=x.email),x.password&&(n.password=x.password),Object.keys(n).length>0&&e((0,i.TK)(n))},className:"profile-form-module__form__f_ZiM",children:[(0,a.jsx)("div",{className:p,children:(0,a.jsx)(m.pd,{type:"text",placeholder:"Имя",value:x.name,name:"name",error:!1,onChange:j,icon:"EditIcon",size:"default"})}),(0,a.jsx)("div",{className:p,children:(0,a.jsx)(m.j5,{value:x.email,name:"email",isIcon:!0,onChange:j})}),(0,a.jsx)("div",{className:p,children:(0,a.jsx)(m.yA,{value:x.password,name:"password",icon:"EditIcon",onChange:j})}),d&&(0,a.jsx)("p",{className:"profile-form-module__error__XLjag",children:d}),k&&(0,a.jsxs)("div",{className:"profile-form-module__buttons__hpI8m",children:[(0,a.jsx)(m.$n,{htmlType:"button",type:"secondary",size:"medium",onClick:function(){c&&g({name:c.name,email:c.email,password:""})},children:"Отмена"}),(0,a.jsx)(m.$n,{htmlType:"submit",type:"primary",size:"medium",disabled:l,children:l?"Сохранение...":"Сохранить"})]})]})}):null},x=n(4178);var j=function(){var e=(0,s.jL)(),r=(0,o.Zp)(),n=(0,_.As)(),c=n.user,l=n.loading,d=n.isAuthenticated;return(0,t.useEffect)((function(){d?c||e((0,i.wz)()):r("/login")}),[e,d,r,c]),l?(0,a.jsx)("div",{className:"profile-module__loading__IjJj0",children:(0,a.jsx)(f.k,{text:"Загрузка профиля..."})}):d?(0,a.jsx)("div",{className:"profile-module__profilePage__vNbn6",children:(0,a.jsxs)("div",{className:"profile-module__container__Kb2uP",children:[(0,a.jsx)("div",{className:"profile-module__navigation__OwE_G",children:(0,a.jsx)(u,{})}),(0,a.jsx)("div",{className:"profile-module__content__Jo9tx",children:(0,a.jsxs)(o.BV,{children:[(0,a.jsx)(o.qh,{index:!0,element:(0,a.jsx)(v,{})}),(0,a.jsx)(o.qh,{path:"orders",element:(0,a.jsx)(x.OrderHistoryPage,{})})]})})]})}):null}}}]);